udptun
======

## Using Vagrant

1. Start the Vagrant VM:

```
vagrant up
```

2. Set up the tunnel in the VM:

```
./setup-tunnel.sh
```

3. Start the local userspace tunnel endpoint:

```
cd udptun-go/src
go build . && sudo ./main listen --ip 192.168.2.2/24
```

### Running iperf

We should have tunnel interfaces called `test` in the VM and locally with the IP addresses below:

- `192.168.2.1` - Vagrant VM
- `192.168.2.2` - host machine


Start the iperf3 server locally:

```
iperf3 -s
```

Connect to the VM and start the iperf3 client:

```
vagrant ssh
iperf3 -c 192.168.2.2
```



## Using OpenWRT

This repository is an OpenWRT feed.

### Content

* `openspot-kmod-udptun` the udptun kernel module
* `udptun-go` userspace tool to set up a tunnel, also includes `authorized_keys` for SSH
* `diffconfig` the minimal OpenWRT configuration generated by `scripts/diffconfig` from OpenWRT


### Feeds

Add a `feeds.conf` to your OpenWRT folder with the content below:

```
src-git packages https://git.openwrt.org/feed/packages.git;openwrt-19.07
src-link udptun /home/dev/udptun
```

Then run:

```
cd $openwrt
scripts/feeds update -a
scripts/feeds install udptun-go
```

### Building

```
cd $openwrt
make -j8
scp bin/targets/ramips/mt7621/openwrt-ramips-mt7621-ubnt-erx-squashfs-sysupgrade.bin root@erx.dev.digineo.de:/tmp/
```

### Flashing

```
picocom -b 57600 /dev/ttyUSB0
sysupgrade /tmp/*-sysupgrade.bin
```
